<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkins Webhook Proxy :: OpenDevStack</title>
    <link rel="canonical" href="https://www.opendevstack.org/ods-documentation/ods-core/latest/jenkins/webhook-proxy.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation">OpenDevStack</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/common/latest/index.html">Guides and Tutorials</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-core/latest/infrastructure-setup/index.html">ODS Core</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-quickstarters/latest/index.html">ODS Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-provisioning-app/latest/index.html">Provisioning App</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ods-core" data-version="1.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title">ODS Components</h3>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../common/latest/index.html">Guides and Tutorials</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../latest/infrastructure-setup/index.html">ODS Core</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-quickstarters/latest/index.html">ODS Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-provisioning-app/latest/index.html">Provisioning App</a>
      </li>
    </ul>
    <h3 class="title"><a href="../infrastructure-setup/index.html">ODS Core</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infrastructure-setup/index.html">Intro</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sysenv-requirements.html">System and Environment Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infrastructure-setup/index.html">Infrastructure Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jenkins</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Jenkins Overview</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="webhook-proxy.html">Webhook Proxy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="slave-base.html">Jenkins Slave Base Image</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Shared Images</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../shared-images/openresty-nginx.html">OpenResty Base image + WAF</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../shared-images/nginx-authproxy-crowd.html">Crowd Authproxy</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sonarqube/index.html">Sonarqube</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ODS Core</span>
    <span class="version">1.1</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Guides and Tutorials</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../common/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../common/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../common/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../common/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Jenkins Shared Library</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-jenkins-shared-library/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">ODS Core</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../latest/infrastructure-setup/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../2/infrastructure-setup/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../1.2/infrastructure-setup/index.html">1.2</a>
        </li>
        <li class="version is-current">
          <a href="../infrastructure-setup/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/infrastructure-setup/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Project Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-project-quickstarters/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-project-quickstarters/1.1/index.html">1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-quickstarters/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-quickstarters/2/index.html">2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Provisioning App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-provisioning-app/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../common/latest/getting-started/introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../infrastructure-setup/index.html">ODS Core</a></li>
    <li>Jenkins</li>
    <li><a href="webhook-proxy.html">Webhook Proxy</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.1</button>
  <div class="version-menu">
    <a class="version" href="../../latest/jenkins/webhook-proxy.html">latest</a>
    <a class="version" href="../../2/jenkins/webhook-proxy.html">2</a>
    <a class="version" href="../../1.2/jenkins/webhook-proxy.html">1.2</a>
    <a class="version is-current" href="webhook-proxy.html">1.1</a>
    <a class="version is-missing" href="../../v1.0/infrastructure-setup/index.html">v1.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/opendevstack/ods-core/edit/1.1.x/docs/modules/jenkins/pages/webhook-proxy.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Jenkins Webhook Proxy</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Provides one endpoint accepting webhooks from BitBucket and forwards them to the
corresponding Jenkins pipeline (which is determined based on the branch name).
If there is no corresponding pipeline yet, it will be created on the fly. Once a
branch is deleted or a pull request declined/merged, the corresponding Jenkins
pipeline is deleted as well.</p>
</div>
<div class="paragraph">
<p>Jenkinsfiles, within a project are created when provisioning quickstarters,
thru the <a href="https://github.com/opendevstack/ods-provisioning-app">provision app</a>.
The <a href="https://github.com/opendevstack/ods-project-quickstarters/tree/master/boilerplates">quickstarter boilerplates</a>
contain the appropriate skeletons.</p>
</div>
<div class="paragraph">
<p>One instance of the webhook proxy runs in every <code>project</code>-cd namespace next to
the jenkins instance for this <code>project</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_a_webhook_in_bitbucket"><a class="anchor" href="#_adding_a_webhook_in_bitbucket"></a>Adding a webhook in BitBucket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Go to "Repository Settings &gt; Webhooks" and click on "Create webhook". Enter
<code>Jenkins</code> as Title and the route URL (see following <a href="#setup">Setup</a> section) as
URL. Under "Repository events", select <code>Push</code>. Under "Pull request events",
select <code>Merged</code> and <code>Declined</code>. Save your changes and you&#8217;re done! Any other
webhooks already setup to trigger Jenkins are not needed anymore and should be
deactivated or deleted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_the_webhook_proxy_in_a_cd_namespace"><a class="anchor" href="#_setup_the_webhook_proxy_in_a_cd_namespace"></a>Setup the webhook proxy in a <code>*-cd</code> namespace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run <code>tailor update</code> in <code>ocp-config</code>. This will create <code>BuildConfig</code> and
<code>ImageStream</code> in the central <code>cd</code> namespace. Next, you will have to create a
<code>DeploymentConfig</code>, <code>Service</code> and <code>Route</code> in the namespace your Jenkins instance
runs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_behaviour_of_the_webhook_proxy"><a class="anchor" href="#_customizing_the_behaviour_of_the_webhook_proxy"></a>Customizing the behaviour of the webhook proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following environment variables are read by the proxy:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROTECTED_BRANCHES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of branches which pipelines should not be cleaned up. Use either exact branch names, branch prefixes (e.g. <code>feature/</code>) or <code>*</code> for all branches. Defaults to: <code>master,develop,production,staging,release/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_API_HOST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defaults to <code>openshift.default.svc.cluster.local</code>. Usually does not need to be modified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REPO_BASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base URL of the repository (e.g. your BitBucket host). This variable is set by the template and usually does not need to be modified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRIGGER_SECRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The secret which protects the pipeline to be executed from outside. This variable is set by the template and usually does not need to be modified.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_development"><a class="anchor" href="#_development"></a>Development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See the <code>Makefile</code> targets.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/ods-core/1.1/jenkins/webhook-proxy.html'
</script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js"></script>
<script async src="../../../_/../search-index.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
