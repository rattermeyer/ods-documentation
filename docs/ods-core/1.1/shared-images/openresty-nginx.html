<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Alpine Nginx OpenResty + Lua + ModSecurity WAF base image :: OpenDevStack</title>
    <link rel="canonical" href="https://www.opendevstack.org/ods-documentation/ods-core/1.2/shared-images/openresty-nginx.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation">OpenDevStack</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/common/latest/index.html">Guides and Tutorials</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-core/latest/infrastructure-setup/index.html">ODS Core</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-quickstarters/latest/index.html">ODS Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-provisioning-app/latest/index.html">Provisioning App</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ods-core" data-version="1.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title">ODS Components</h3>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../common/latest/index.html">Guides and Tutorials</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../latest/infrastructure-setup/index.html">ODS Core</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-quickstarters/latest/index.html">ODS Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-provisioning-app/latest/index.html">Provisioning App</a>
      </li>
    </ul>
    <h3 class="title"><a href="../infrastructure-setup/index.html">ODS Core</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infrastructure-setup/index.html">Intro</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sysenv-requirements.html">System and Environment Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infrastructure-setup/index.html">Infrastructure Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jenkins</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/index.html">Jenkins Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/webhook-proxy.html">Webhook Proxy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/slave-base.html">Jenkins Slave Base Image</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Shared Images</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="openresty-nginx.html">OpenResty Base image + WAF</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nginx-authproxy-crowd.html">Crowd Authproxy</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sonarqube/index.html">Sonarqube</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ODS Core</span>
    <span class="version">1.1</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Guides and Tutorials</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../common/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../common/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../common/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../common/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Jenkins Shared Library</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-jenkins-shared-library/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">ODS Core</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../latest/infrastructure-setup/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../2/infrastructure-setup/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../1.2/infrastructure-setup/index.html">1.2</a>
        </li>
        <li class="version is-current">
          <a href="../infrastructure-setup/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/infrastructure-setup/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Project Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-project-quickstarters/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-project-quickstarters/1.1/index.html">1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-quickstarters/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-quickstarters/2/index.html">2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Provisioning App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-provisioning-app/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../common/latest/getting-started/introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../infrastructure-setup/index.html">ODS Core</a></li>
    <li>Shared Images</li>
    <li><a href="openresty-nginx.html">OpenResty Base image + WAF</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.1</button>
  <div class="version-menu">
    <a class="version is-missing" href="../../latest/infrastructure-setup/index.html">latest</a>
    <a class="version is-missing" href="../../2/infrastructure-setup/index.html">2</a>
    <a class="version" href="../../1.2/shared-images/openresty-nginx.html">1.2</a>
    <a class="version is-current" href="openresty-nginx.html">1.1</a>
    <a class="version is-missing" href="../../v1.0/infrastructure-setup/index.html">v1.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/opendevstack/ods-core/edit/1.1.x/docs/modules/shared-images/pages/openresty-nginx.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Alpine Nginx OpenResty + Lua + ModSecurity WAF base image</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Nginx based project with Lua enablement and WAF module integrated (default 'off'). Ready for scripting/developing API gateways.</p>
</div>
<div class="paragraph">
<p>Modsecurity is also ready to be used with default OWASP CRS rulesets, but disabled by default.
To enable it you need to set on 'WAF_MODSECURITY' to on (off by default) environment variable and it will be applied in nginx.conf.
For applying different custom configs you will need to load and replace with new modsecurity.conf and crs-setup.conf files.</p>
</div>
<div class="paragraph">
<p>You can also enable dynamic configuration and new functionalities through Lua nginx scripting. See more in openresty-nginx README.</p>
</div>
<div class="paragraph">
<p>There is no usage of separate nginx virtual host file config since one needs to have the server statement inside the http statement in nginx.conf for loading environment variables in such statement. Therefore, 'server' statement config must go inside nginx.conf inside 'http' statement config.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nginx_modules"><a class="anchor" href="#_nginx_modules"></a>NGINX MODULES</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/SpiderLabs/ModSecurity/wiki">Modsecurity</a>: Modsecurity module with the OWASP CSR default entries. Enable or disable (default is disabled) it by setting environment variable WAF_MODSECURITY (values: on, off). Components being used:</p>
<div class="ulist">
<ul>
<li>
<p>ModSecurity library <a href="https://github.com/SpiderLabs/ModSecurity/blob/v3/master/README.md">documentation</a></p>
</li>
<li>
<p>Nginx ModSecurity connector <a href="https://github.com/SpiderLabs/ModSecurity-nginx">documentation</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lua_modules"><a class="anchor" href="#_lua_modules"></a>Lua MODULES</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Crowd HTTP Auth: Crowd REALM Auth Lua module. Check shared-images/nginx-authproxy-crowd to how to use it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See lua/ folder for further examples ready to be used</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_versioning"><a class="anchor" href="#_versioning"></a>VERSIONING</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to upgrade to newer versions just change the related *_VERSION values in the base Dockerfile image. Current managed versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RESTY_IMAGE_BASE="alpine"</p>
</li>
<li>
<p>RESTY_IMAGE_TAG="3.8"</p>
</li>
<li>
<p>NGINX_VERSION="1.13.6"</p>
</li>
<li>
<p>MODSECURITY_VERSION="3.0.0"</p>
</li>
<li>
<p>MODSECURITY_NGINX_VERSION="1.0.0"</p>
</li>
<li>
<p>OWASP_MODSECURITY_CRS_VERSION="3.0.2"</p>
</li>
<li>
<p>RESTY_VERSION="1.13.6.2"</p>
</li>
<li>
<p>RESTY_OPENSSL_VERSION="1.0.2p"</p>
</li>
<li>
<p>RESTY_PCRE_VERSION="8.42"</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_waf_security_and_nginx_performance"><a class="anchor" href="#_testing_waf_security_and_nginx_performance"></a>Testing WAF security and Nginx performance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Security:</p>
<div class="listingblock">
<div class="content">
<pre>nikto -h http://&lt;host:port&gt;</pre>
</div>
</div>
</li>
<li>
<p>Performance:</p>
<div class="listingblock">
<div class="content">
<pre> siege --concurrent 100 --reps 10 http://&lt;host:port&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/ods-core/1.1/shared-images/openresty-nginx.html'
</script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js"></script>
<script async src="../../../_/../search-index.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
