<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkins :: OpenDevStack</title>
    <link rel="canonical" href="https://www.opendevstack.org/ods-documentation/ods-core/latest/jenkins/index.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation">OpenDevStack</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/common/latest/index.html">Guides and Tutorials</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-core/latest/infrastructure-setup/index.html">ODS Core</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-quickstarters/latest/index.html">ODS Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-provisioning-app/latest/index.html">Provisioning App</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ods-core" data-version="v1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title">ODS Components</h3>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../common/latest/index.html">Guides and Tutorials</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../latest/infrastructure-setup/index.html">ODS Core</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-quickstarters/latest/index.html">ODS Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-provisioning-app/latest/index.html">Provisioning App</a>
      </li>
    </ul>
    <h3 class="title"><a href="../infrastructure-setup/index.html">ODS Core</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infrastructure-setup/index.html">Intro</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sysenv-requirements.html">System and Environment Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infrastructure-setup/index.html">Infrastructure Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="index.html">Jenkins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../shared-images/index.html">Shared Images</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sonarqube/index.html">Sonarqube</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ODS Core</span>
    <span class="version">v1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Guides and Tutorials</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../common/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../common/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../common/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../common/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Jenkins Shared Library</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-jenkins-shared-library/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">ODS Core</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../latest/infrastructure-setup/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../2/infrastructure-setup/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../1.2/infrastructure-setup/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../1.1/infrastructure-setup/index.html">1.1</a>
        </li>
        <li class="version is-current">
          <a href="../infrastructure-setup/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Project Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-project-quickstarters/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-project-quickstarters/1.1/index.html">1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-quickstarters/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-quickstarters/2/index.html">2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Provisioning App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-provisioning-app/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../common/latest/getting-started/introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../infrastructure-setup/index.html">ODS Core</a></li>
    <li><a href="index.html">Jenkins</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v1.0</button>
  <div class="version-menu">
    <a class="version" href="../../latest/jenkins/index.html">latest</a>
    <a class="version" href="../../2/jenkins/index.html">2</a>
    <a class="version" href="../../1.2/jenkins/index.html">1.2</a>
    <a class="version" href="../../1.1/jenkins/index.html">1.1</a>
    <a class="version is-current" href="index.html">v1.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/opendevstack/ods-core/edit/1.0.x/docs/modules/jenkins/pages/index.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Jenkins</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>OpenDevStack provides several customized Jenkins Docker Images based on the official OpenShift images.
The idea is, that you do not need to configure anything on Jenkings before you can start using it.</p>
</div>
<div class="paragraph">
<p>In <code>ods-core/jenkins</code>, you find the following directory structure:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Table Directories</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">master</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dockerfile for Jenkins Master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ocp-config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift templates and Tailorfile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">slave-base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dockerfile and customization for Jenkins Slave Images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">webhook-proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dockerfile and source code for Bitbucket webhook proxy</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_jenkins_master"><a class="anchor" href="#_jenkins_master"></a>Jenkins Master</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following customizations are applied to enable more automatic deployment of Jenkins.</p>
</div>
<div class="sect2">
<h3 id="_configured_plugins"><a class="anchor" href="#_configured_plugins"></a>Configured Plugins</h3>
<div class="paragraph">
<p>We have included some base plugins</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">token-macro:2.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">greenballs:1.15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credentials-binding:1.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email-ext:2.63</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sonar:2.6.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ansicolor:0.5.2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_init_groovy_scripts"><a class="anchor" href="#_init_groovy_scripts"></a>Init groovy scripts</h3>
<div class="paragraph">
<p>Jira offers to deploy <a href="https://wiki.jenkins.io/display/JENKINS/Post-initialization+script"> post-initialization </a> scripts.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Table Post-Initialization Scripts</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Script</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url.groovy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Jenkins Location based on the OpenShift route</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sonarqube.groovy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the sonarserver url and auth token based on the configured secrets and config maps</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following environment variables must be available to Jenkins:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SONAR_SERVER_URL</dt>
<dd>
<p>specifies the location of the sonarqube server.</p>
</dd>
<dt class="hdlist1">SONAR_AUTH_TOKEN</dt>
<dd>
<p>this is the sonarqube auth token that is generated when deploying and configuring sonarqube</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_mail_sending"><a class="anchor" href="#_mail_sending"></a>Mail Sending</h3>
<div class="paragraph">
<p>We enable (in Dockerfile) the sending of mails to unknown users and users without read rights.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jenkins_slave"><a class="anchor" href="#_jenkins_slave"></a>Jenkins Slave</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have a base image for different jenkins slaves.
The concrete slave images are then configured as part of the quickstarters.
The base image contains the following customizations</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sonarqube Scanner</p>
</li>
<li>
<p>Sonarqube CNES Report Plugin</p>
</li>
<li>
<p>OWASP Dependency Checker</p>
</li>
<li>
<p>Tailor</p>
</li>
<li>
<p>Setting of Enterprise Proxy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the docker image is built, it fetchtes automatically the OpenShift root CA certificate and stores it, so that the <code>oc</code>-cli tool
can pick it up later and also adds the base domain wildcard certificate to the Java certificate store.</p>
</div>
<div class="paragraph">
<p>The setting of the enterprise proxy takes care that Jenkins slave works also on OpenShift clusters in enterprises that use a web proxy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_webhook_proxy"><a class="anchor" href="#_webhook_proxy"></a>Webhook Proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provides one endpoint accepting webhooks from BitBucket and forwards them to the
corresponding Jenkins pipeline (which is determined based on the branch name).
If there is no corresponding pipeline yet, it will be created on the fly. Once a
branch is deleted or a pull request declined/merged, the corresponding Jenkins
pipeline is deleted as well.</p>
</div>
<div class="sect2">
<h3 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h3>
<div class="paragraph">
<p>Go to "Repository Settings &gt; Webhooks" and click on "Create webhook". Enter
<code>Jenkins</code> as Title and the route URL (see following <a href="#_setup">Setup</a> section) as
URL. Under "Repository events", select <code>Push</code>. Under "Pull request events",
select <code>Merged</code> and <code>Declined</code>. Save your changes and you&#8217;re done! Any other
webhooks already setup to trigger Jenkins are not needed anymore and should be
deactivated or deleted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setup"><a class="anchor" href="#_setup"></a>Setup</h3>
<div class="paragraph">
<p>Run <code>tailor update</code> in <code>ocp-config</code>. This will create <code>BuildConfig</code> and
<code>ImageStream</code> in the central <code>cd</code> namespace. Next, you will have to create a
<code>DeploymentConfig</code>, <code>Service</code> and <code>Route</code> in the namespace your Jenkins instance
runs.</p>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/ods-core/v1.0/jenkins/index.html'
</script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js"></script>
<script async src="../../../_/../search-index.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
